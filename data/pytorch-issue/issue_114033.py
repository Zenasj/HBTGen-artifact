import torch
import torchvision
import torchvision.transforms as transforms
import torch.nn as nn
import os
import torch.nn.functional as F
gpu_device = torch.device("cuda")
cpu_device = torch.device("cpu")
class PreprocessAndCalculateModel(nn.Module):
    def __init__(self):
        super().__init__()
    def forward(self, x):
        output = x.digamma()
        return output


real_inputs = torch.Tensor([[[ 1.7135e+00,  2.3066e+00,  1.1740e+00, -5.1265e-01, -4.9885e-01,
           1.9729e+00,  1.8526e+00, -4.0406e-01,  4.8357e-01,  6.8179e-01,
           1.4103e+00,  1.8201e+00,  1.3823e+00, -3.5576e-01,  1.5081e+00,
          -6.7793e-03, -4.3921e-01,  1.2678e+00, -4.4670e-01, -3.1154e-01,
           4.1619e-01, -4.2254e-01,  1.5163e+00,  2.1191e+00, -3.9304e-01,
           2.0168e+00,  1.7366e+00, -1.0700e-01, -9.4768e-01, -5.1661e-01,
          -4.3103e-01, -2.5479e-01],
         [-8.2059e-02,  1.4648e+00, -1.5247e-01, -1.4189e-01,  3.3128e+00,
          -1.5294e-01,  1.2475e+00, -1.9703e-01,  1.9662e+00, -2.0902e-01,
           1.3072e+00, -2.6040e-01, -2.4278e-01, -5.6654e-02, -3.0158e-01,
          -2.7409e-01, -6.6546e-01, -4.9867e-01, -2.2856e-01,  6.2303e-01,
           1.6592e+00,  8.9343e-01,  5.3308e-01, -1.1093e-01,  3.8787e+00,
           4.9506e-01,  4.6887e-01, -4.4490e-01,  7.6734e-03, -1.1976e-01,
           1.3887e+00,  4.0982e-01],
         [-1.2766e-01,  6.1344e-01,  1.6100e-01,  6.4792e-01,  1.8034e+00,
          -6.4829e-01,  1.0711e+00,  1.2020e+00,  1.7806e+00,  8.6462e-01,
           4.8888e-01, -6.6852e-01,  1.6678e+00,  1.4003e+00,  1.4488e+00,
          -7.7705e-01,  1.4907e+00,  1.3443e+00,  2.3499e+00, -8.6561e-01,
           2.1844e+00,  2.9950e-01,  6.7562e-01,  1.3756e+00,  2.3819e+00,
          -4.6650e-01,  1.4105e+00, -6.7233e-01,  2.1345e+00, -1.2599e-01,
          -1.5936e-01,  2.2875e-01],
         [ 1.1738e+00, -7.3000e-01,  6.2288e-02, -3.6592e-01,  4.1990e-01,
           1.2027e+00, -1.0904e+00, -5.5555e-01, -1.3838e-01,  2.3400e+00,
           1.6213e+00, -8.7183e-02,  7.7050e-01,  1.6661e-01,  3.9870e+00,
          -3.5605e-01, -1.5156e-01, -4.7850e-01,  3.0841e-01,  1.6606e+00,
          -6.1644e-01,  2.3647e+00,  1.8743e+00, -2.7205e-02,  6.3772e-01,
           2.7852e+00, -3.8084e-01, -3.7526e-01,  9.7064e-01, -4.9685e-02,
          -3.7118e-01,  2.3139e+00],
         [ 6.5583e-01,  2.3373e-01,  1.5769e+00,  1.1180e+00,  6.6475e-01,
           1.3268e+00, -1.9223e-01, -1.9838e-01,  7.7690e-02, -3.9388e-01,
          -1.8305e-01,  7.9815e-01, -1.1906e-01,  7.3641e-01,  1.3109e+00,
           2.4934e+00,  3.2969e-01, -1.0318e+00,  1.2129e-01,  1.6188e+00,
           7.6120e-01,  1.2003e-01, -1.2087e+00,  1.6387e-01,  1.1522e+00,
           7.7542e-01,  1.9580e+00,  1.8958e+00,  2.3644e+00,  2.7464e+00,
           5.1715e-01,  1.1888e-01],
         [ 8.2930e-01,  1.1961e+00,  1.6988e+00,  1.9785e+00, -5.2601e-01,
           1.2279e+00,  5.8140e-01,  1.7506e+00,  1.6197e+00, -8.7089e-01,
           1.2590e+00,  2.5602e-01, -8.3124e-01,  1.6166e+00, -7.8801e-01,
           2.1044e+00,  4.7251e-01, -5.5604e-01,  8.6728e-01, -3.3707e-01,
          -9.2334e-01,  1.2959e+00,  3.7524e-02,  1.1106e+00,  5.7195e-01,
          -1.6390e-01,  2.2064e+00,  1.7459e-01,  1.1404e-01,  7.3292e-01,
           9.3747e-01,  2.4329e-01],
         [-1.4399e+00, -1.6214e-01, -1.1299e+00,  6.0514e-02,  1.3071e+00,
           1.3450e-01,  1.1286e+00,  9.0065e-01,  7.7153e-01,  4.5837e-01,
           4.1191e-01,  4.6127e-01,  9.8940e-01,  1.6442e+00,  5.8451e-02,
          -5.0859e-01,  5.2242e-01,  1.9510e+00,  1.9456e+00,  5.9023e-01,
           9.9600e-01,  2.9787e-01,  1.3945e+00,  1.8510e+00, -4.2281e-01,
           4.3291e-01,  1.6059e-01,  1.4784e+00,  1.7935e-01,  5.4448e-01,
           1.7508e+00,  5.3155e-01],
         [-1.5740e-01,  3.6168e-01,  1.4898e+00,  9.8021e-01,  5.3630e-01,
           4.9197e-01,  5.9637e-01,  3.1615e+00,  3.6002e-01,  4.4017e-01,
           7.1960e-01,  2.2833e+00,  3.5104e-01,  4.8184e-01,  1.0410e+00,
          -8.0150e-01,  5.6835e-02,  1.0324e+00, -4.0356e-01,  5.8403e-01,
           1.4440e+00,  1.5719e+00,  1.6285e+00,  1.3600e+00,  1.1932e+00,
           2.5756e+00, -2.1612e-02,  1.1656e+00, -8.8123e-01, -5.6939e-01,
           4.9344e-01, -4.1797e-02],
         [-8.4583e-01, -3.3541e-01, -1.5202e+00, -1.1368e+00,  4.8056e-01,
           1.3061e+00,  9.5384e-01, -1.0351e+00,  2.3968e+00,  5.1020e-01,
          -3.3144e-01, -1.2508e+00,  2.3941e+00, -5.4588e-01,  7.4293e-01,
           8.6277e-01, -3.9790e-01,  3.1921e-02,  5.5410e-01,  1.6155e+00,
          -1.8209e-01,  2.8105e-01, -8.8123e-01, -1.0434e+00,  3.2600e-01,
          -3.1389e-01, -1.6616e-01,  5.5049e-01, -2.2286e-01,  7.4886e-01,
           8.3317e-01,  6.4340e-01],
         [-4.2533e-01,  4.0096e-01,  3.3938e-01, -5.9830e-01,  1.1421e+00,
           8.3352e-01,  4.1736e-01, -1.3450e+00,  7.9433e-01,  1.4704e+00,
           4.6790e-01,  7.1499e-01,  1.2570e+00,  1.4970e+00,  1.9955e+00,
           1.0178e+00, -7.9983e-01,  2.0834e+00,  9.8919e-01, -7.3677e-01,
          -6.0129e-01, -1.3898e+00,  6.8357e-01,  5.3470e-01, -1.0884e-01,
           5.3366e-01,  1.9472e-05, -2.8092e-01,  3.1706e-01, -5.8916e-01,
          -6.1233e-01, -1.4214e-01],
         [ 1.2663e+00,  1.4310e+00,  2.0094e+00,  2.3126e+00,  1.2099e+00,
           1.6867e+00,  8.9299e-01,  2.2554e+00, -5.9163e-01,  1.0490e+00,
          -8.6442e-01,  1.3114e+00, -9.9735e-01,  7.4739e-01,  2.2011e-01,
           1.2767e+00,  1.6121e+00, -8.1254e-01,  7.4510e-01,  1.9135e-01,
           1.1146e+00, -7.8761e-02, -9.0091e-01,  3.5561e-01, -1.0577e+00,
           1.3669e+00,  4.8484e-01,  7.5238e-01, -6.1455e-01,  3.5708e-01,
          -8.7359e-01,  8.4948e-02],
         [-5.5899e-01,  3.2090e-01,  1.2613e+00, -1.9006e-01,  8.5696e-01,
           5.3955e-01,  9.8275e-01,  1.4479e+00,  1.4764e+00,  2.4134e+00,
           1.0522e+00,  1.5815e+00,  1.7971e+00, -4.8315e-02,  9.1354e-01,
           1.1214e+00, -2.0197e-01,  1.6815e+00,  7.1221e-01,  1.3291e+00,
          -6.8647e-01,  7.0332e-01,  7.4508e-01,  2.1185e+00, -7.1747e-01,
           2.4184e-01,  9.0677e-01,  2.0444e+00, -9.3440e-01,  7.2164e-01,
          -3.0115e-01, -3.5223e-01],
         [ 1.9153e-01, -8.5072e-01, -1.1975e+00, -8.9834e-01,  1.7418e+00,
           9.1636e-02,  1.6654e+00, -3.2741e-01,  1.6577e+00,  2.0147e-01,
           4.3668e-01,  2.5346e-01,  1.2507e+00, -7.4143e-01, -6.6035e-01,
          -6.2545e-01,  2.4071e-01,  2.1870e+00, -4.9309e-01,  4.1328e-01,
           1.6859e+00, -3.9719e-01,  1.4324e+00,  6.9953e-01,  1.5570e-01,
           4.5104e-01,  1.2715e-01,  1.7502e+00,  1.1275e+00,  8.7737e-01,
           1.6773e+00,  1.1995e+00],
         [-8.8080e-02,  5.7772e-01,  6.0863e-01,  1.1276e+00,  1.9968e+00,
          -6.4769e-01, -4.4184e-01, -5.9778e-01,  2.0299e+00,  1.2281e-01,
           1.0880e+00, -9.3893e-01,  1.3044e+00,  1.8740e-02, -4.6746e-01,
           8.7645e-01,  3.7911e+00,  1.3273e+00,  5.6304e-01,  4.1983e-01,
           1.3194e+00,  8.7551e-01, -5.3678e-01,  6.3954e-01,  1.0318e+00,
          -5.9279e-01, -5.3671e-01, -6.1317e-01,  3.9252e-01,  8.9714e-02,
           7.4975e-01, -2.6960e-01],
         [-5.5083e-01, -3.1540e-01, -1.5156e+00, -1.4130e+00,  2.4793e-01,
           1.1848e-01,  2.9389e-01,  1.1748e-01,  4.8290e-02,  3.1237e+00,
           6.8091e-01, -7.9360e-01,  1.6335e+00,  1.5668e+00,  8.2968e-01,
           1.0485e+00,  9.2854e-01,  5.0508e-01,  1.6002e+00,  2.6950e-01,
          -8.5051e-01,  2.0358e+00,  2.0323e-01,  8.7585e-01, -3.3098e-01,
           4.5595e-01, -4.5244e-01,  6.7998e-02,  1.1896e-02,  2.2729e-01,
           1.8508e+00,  1.2362e+00],
         [ 1.0140e+00, -4.2395e-01, -2.7121e-01, -4.7649e-01, -7.5349e-02,
           9.5214e-02, -6.1641e-01, -6.1404e-01, -5.7811e-01,  1.2651e+00,
           2.9030e+00, -4.3586e-01, -2.2360e-01,  2.3229e+00,  1.2791e-01,
           1.0632e-01,  4.0830e-01, -3.7541e-01,  5.7567e-01,  1.6707e+00,
          -2.8982e-01,  1.7875e-01,  2.8614e+00, -4.2806e-01, -3.5132e-01,
           2.2177e+00, -4.3814e-01, -8.8190e-01, -2.3794e-02, -4.0672e-01,
           1.0030e+00,  2.6636e+00]],

        [[-3.3631e-01, -1.0779e-01,  1.2558e+00, -3.1143e-01,  6.8396e-01,
           1.3248e+00,  1.2112e+00,  1.8237e+00, -7.7678e-01, -6.7839e-01,
           1.5647e+00, -5.4618e-01, -6.5524e-01,  3.6653e+00,  2.6212e-02,
           6.5826e-01,  8.7125e-01,  1.6355e+00,  1.0721e+00, -5.3414e-01,
          -1.5042e-01,  1.1567e+00, -4.7517e-01,  2.5955e+00, -8.3611e-01,
           1.4614e-01, -4.1697e-01, -3.7459e-01, -4.3606e-01, -6.5901e-01,
          -2.6396e-01, -5.4429e-01],
         [ 1.5389e+00,  7.1362e-01, -4.5504e-01, -1.2877e-01,  1.8797e+00,
          -2.5577e-01,  4.5240e-01, -1.2350e-01,  3.9544e+00,  4.0202e-01,
          -4.2459e-01,  2.6528e+00,  6.9349e-01, -2.3717e-01, -3.7003e-01,
          -7.8638e-01,  1.5275e+00, -5.1386e-02, -2.8439e-01, -4.5797e-01,
           9.6303e-01,  9.9244e-01, -2.4032e-01,  3.0965e+00,  1.6397e+00,
           2.9317e-02,  1.2531e+00, -1.5528e-01, -2.9296e-01,  3.0533e-01,
          -1.4886e-02, -1.9007e-01],
         [ 2.8545e-01, -1.9952e-01,  3.6851e-01, -3.7398e-02,  1.8691e+00,
           1.5093e-01, -1.9878e-01, -4.7331e-01,  2.7840e+00,  1.6306e+00,
          -7.1123e-01,  4.5132e-01,  4.2379e-01,  4.0010e-01, -3.7805e-01,
           4.3582e-01,  3.0216e+00,  1.5560e-01, -8.0922e-01, -2.9316e-01,
           9.0603e-01, -5.8767e-01, -9.8963e-01,  3.9593e-01,  1.4550e+00,
          -9.9079e-01,  1.3926e+00, -1.0775e-01,  5.9523e-01,  3.3858e-02,
          -8.4154e-01,  1.2936e+00],
         [ 2.1942e-01, -2.2606e-01, -4.2003e-01, -1.8212e-01,  3.0189e-01,
           7.9912e-01,  5.7309e-01,  3.0226e-01, -1.2788e-01, -4.8040e-01,
           2.7851e+00, -2.3030e-01,  7.9007e-02,  1.6587e+00, -3.5791e-01,
           1.1796e+00, -5.2563e-02,  9.1973e-01,  4.7619e-01, -7.2598e-01,
           1.9515e+00, -1.4602e-01,  4.3622e-01,  2.2010e+00,  9.1603e-01,
           3.0887e+00,  2.7105e-01, -1.1006e-01, -2.2251e-01,  1.0385e+00,
           1.3819e+00, -4.8654e-01],
         [ 1.2050e+00,  1.3410e+00,  1.8737e-01,  1.8677e+00, -4.0279e-01,
           1.6788e+00,  5.8558e-01, -1.1873e+00,  4.0137e-01,  5.6073e-01,
           1.3234e+00,  1.4921e+00, -8.7747e-02, -3.0928e-01, -1.1593e+00,
          -1.5831e+00,  3.9609e-01,  3.3170e-01, -5.6392e-01,  2.3158e+00,
           8.2064e-01, -2.1873e-01, -1.2267e+00, -1.1316e+00, -1.4043e-01,
          -1.2289e+00,  2.6007e-01,  1.3876e+00,  2.9273e-04,  1.2383e+00,
           6.6109e-01,  4.8760e-01],
         [ 1.6200e+00,  1.6759e+00,  1.6307e+00,  2.0600e+00, -8.5991e-01,
          -2.9727e-01,  1.1985e+00, -8.3181e-01,  9.3433e-01, -6.4547e-02,
           2.9391e-01,  2.3121e+00, -7.5559e-01, -5.3644e-01,  2.4238e-01,
          -7.8707e-01,  1.6217e-01,  6.9175e-01,  1.5762e+00,  8.0953e-01,
          -7.0429e-01,  1.4263e+00, -1.2996e-02, -6.2591e-01, -5.3500e-01,
          -2.4321e-01,  2.7853e+00,  1.5075e+00,  4.1384e-02,  5.9093e-01,
          -5.6564e-02,  3.0290e-01],
         [-1.4455e+00, -1.5462e+00, -7.5736e-01, -7.9821e-01,  1.1993e-01,
           4.6204e-01, -2.2440e-01,  3.1396e-01,  7.8847e-01,  2.7591e+00,
           1.1691e+00, -2.4376e-01,  1.0017e+00,  1.1891e-01,  2.1820e+00,
          -1.3098e-02, -5.4640e-01,  1.4942e+00,  4.8310e-01,  2.7218e-01,
           7.0266e-02,  1.0550e+00,  1.2156e+00,  1.1098e+00,  1.1731e+00,
           1.3412e+00,  1.8980e-01,  8.7930e-01,  3.1383e-02,  1.3047e+00,
           5.7751e-01,  1.9685e-01],
         [-1.2528e+00,  7.6389e-01,  1.2104e+00,  1.2814e+00, -7.7344e-01,
           1.2571e+00,  1.2251e+00,  1.0247e-01,  1.3276e-01,  3.4602e-01,
           1.6196e+00, -1.3683e+00,  1.6443e+00,  1.2507e+00,  1.1249e+00,
           1.1950e+00, -5.0286e-02,  3.1420e-01,  7.4372e-01, -7.8814e-01,
           7.8731e-01,  6.7174e-01, -6.1589e-02,  8.9138e-01,  8.8842e-01,
          -3.6759e-01, -1.0132e+00,  6.8591e-01, -5.9977e-01, -7.9476e-01,
           1.1333e-01, -4.4720e-01],
         [ 5.7809e-01, -6.1781e-01, -9.9706e-01, -9.2740e-01,  1.5206e+00,
           6.0295e-01,  1.6608e+00, -7.3317e-01,  1.5920e+00,  1.1226e-02,
          -9.0118e-02,  2.2638e+00,  8.4841e-01, -8.8234e-02,  3.4773e-01,
           6.1796e-01,  1.8740e+00,  6.3576e-01,  1.4157e+00,  2.1687e-01,
           8.0255e-01,  2.4328e+00,  2.1438e+00,  1.7164e-01,  1.0990e+00,
           1.7222e+00,  5.3262e-01,  2.9736e-01,  3.0209e-01,  2.0505e+00,
           1.4177e+00,  8.8935e-01],
         [ 2.8260e-01,  1.8834e-01,  9.4841e-01, -7.8676e-01,  2.5373e+00,
           1.3367e+00,  7.2229e-01,  2.3112e+00,  1.0886e+00,  6.5813e-01,
           3.9301e-01,  1.0571e+00,  1.4519e+00,  1.4492e+00,  7.6221e-01,
           1.6545e+00,  2.2343e+00,  2.3553e+00,  6.9751e-01,  2.2423e-02,
           1.0734e-01,  8.1234e-01,  1.3857e+00, -2.6899e-01,  1.9380e-01,
           5.0671e-01,  4.8700e-01,  3.3984e-01,  6.1506e-02, -2.6123e-01,
          -7.4691e-01, -5.1978e-02],
         [ 5.2949e-01,  1.7314e+00,  1.2164e+00,  1.0843e+00, -1.0098e+00,
           1.4342e+00,  2.6636e-01,  7.6716e-01, -3.9962e-01, -6.0570e-01,
           1.2133e+00,  1.4552e+00, -4.9795e-01,  4.8548e-01,  1.7506e+00,
           6.7853e-01,  1.1233e+00,  9.6053e-01,  2.1961e+00,  5.7909e-01,
          -9.1113e-01,  9.6033e-01,  3.2316e-01,  2.7148e-01,  1.7651e-01,
          -2.6711e-01,  7.6034e-01,  2.0582e+00,  1.1974e-01, -1.2770e-01,
          -7.6036e-01,  7.0130e-01],
         [-7.3810e-01, -5.2629e-01,  3.4070e-01,  1.9784e-01, -7.1902e-01,
           4.1514e-01,  1.7883e+00,  6.7891e-01,  1.1660e+00, -1.2739e-01,
           1.3835e+00,  3.1278e-01,  2.2169e-01,  4.6943e-01,  9.4836e-01,
           1.8219e+00,  4.5790e-01,  7.2050e-01,  1.8567e+00,  4.5197e-01,
          -8.8880e-01,  1.5922e+00,  1.1603e+00,  4.6151e-01,  8.8297e-01,
           3.8887e-01, -2.3762e-01,  1.1832e+00, -5.7442e-01, -3.9789e-01,
          -3.6294e-02,  9.9738e-01],
         [ 5.6255e-01, -9.1782e-01, -8.9236e-01, -6.0076e-01,  1.8475e+00,
           3.8855e-01,  1.3314e+00,  8.3579e-01, -5.0519e-01,  2.1036e-01,
          -3.2604e-01, -6.2861e-01,  1.3503e+00, -3.3445e-02,  1.5492e+00,
           4.8788e-01,  3.0221e+00, -3.9697e-01,  4.7555e-01, -1.9127e-02,
           9.9653e-01,  9.0758e-01,  2.1229e+00,  3.2561e-01,  2.2927e+00,
           8.5101e-01, -9.2935e-01, -7.3109e-01,  1.8896e+00,  1.5048e+00,
           8.2679e-01,  2.5283e+00],
         [ 1.4109e+00, -4.5967e-01,  3.1535e-01, -3.4729e-01,  1.8111e+00,
          -2.0003e-01, -7.5670e-01, -8.4558e-01,  1.5359e+00,  1.4534e+00,
          -2.1072e-01,  9.2529e-02,  1.2452e+00, -5.2515e-01, -3.2976e-01,
          -5.6990e-01,  1.3779e+00, -5.2642e-01, -8.4521e-01,  2.8385e+00,
           1.9397e+00,  3.4085e-01, -6.2664e-01,  1.8035e+00,  2.1328e+00,
          -5.3832e-01,  3.6066e+00,  6.9041e-02,  1.0215e+00, -1.1945e-01,
          -6.7376e-01, -5.2476e-01],
         [-1.1442e+00, -9.9220e-01, -8.2785e-01, -1.5205e+00, -1.0618e-02,
          -3.1782e-02,  8.0680e-01,  6.2356e-01,  3.3966e-01,  9.7933e-01,
           4.7627e-01,  1.5919e+00,  8.6789e-01,  7.6804e-01,  7.1755e-01,
           1.4896e+00,  1.7071e+00,  9.7681e-01,  8.1555e-01,  2.4393e-03,
           3.2413e-01,  2.4577e+00,  1.8687e+00,  1.6818e-01, -3.3640e-02,
           2.3348e+00,  5.2114e-01,  4.1874e-01,  7.0145e-01, -1.7548e-02,
           3.8563e-01,  1.0161e-01],
         [-2.5877e-01, -4.7630e-01, -5.4868e-01, -4.7616e-01, -2.0510e-01,
          -3.7237e-01, -4.1493e-01, -1.5899e-01, -5.5714e-01,  3.2520e-01,
           3.1793e+00, -2.3302e-01, -7.9676e-01,  9.6750e-01,  1.4876e+00,
           5.9042e-01,  7.9243e-01,  1.2511e+00, -2.0444e-01, -2.1816e-01,
           7.8139e-01,  8.9777e-01,  1.4030e+00,  1.9330e+00,  1.4580e+00,
           3.4410e+00,  1.9612e+00, -2.2487e-01,  8.8939e-01,  3.8742e-01,
           3.3917e-01, -2.8983e-01]]])

model = PreprocessAndCalculateModel()
x = real_inputs
output_gpu = model.to(gpu_device)(x.cuda())
output_cpu = model.to(cpu_device)(x.cpu())
print(torch.allclose(output_gpu.cpu(), output_cpu, atol=1e-7))
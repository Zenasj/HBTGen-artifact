import torch
import torch.nn as nn

X = torch.tensor([   # shape: [4,3,4]
    [[1,2,3,4],[5,6,7,8],[9,10,11,12]],
    [[2,3,4,5],[6,7,8,9],[10,11,12,13]],
    [[3,4,5,6],[7,8,9,10],[11,12,13,14]],
    [[4,5,6,7],[8,9,10,11],[12,13,14,15]],
],dtype=torch.float)

layer = torch.nn.BatchNorm1d(3,momentum=0.1,affine=True,track_running_stats=True)
Y = layer(X)
print(Y)
# tensor([[[-1.8974, -1.2649, -0.6325,  0.0000],
#          [-1.8974, -1.2649, -0.6325,  0.0000],
#          [-1.8974, -1.2649, -0.6325,  0.0000]],
#
#         [[-1.2649, -0.6325,  0.0000,  0.6325],
#          [-1.2649, -0.6325,  0.0000,  0.6325],
#          [-1.2649, -0.6325,  0.0000,  0.6325]],
#
#         [[-0.6325,  0.0000,  0.6325,  1.2649],
#          [-0.6325,  0.0000,  0.6325,  1.2649],
#          [-0.6325,  0.0000,  0.6325,  1.2649]],
#
#         [[ 0.0000,  0.6325,  1.2649,  1.8974],
#          [ 0.0000,  0.6325,  1.2649,  1.8974],
#          [ 0.0000,  0.6325,  1.2649,  1.8974]]],
#        grad_fn=<NativeBatchNormBackward>)
print(layer.running_var) 
# tensor([1.1667, 1.1667, 1.1667])

X = torch.tensor([
    [1.0,2.0,3.0,4.0],
    [2.0,3.0,4.0,5.0],
    [3.0,4.0,5.0,6.0],
    [4.0,5.0,6.0,7.0],
])
X = torch.tensor([
    [1.0,2.0,3.0,4.0],
    [2.0,3.0,4.0,5.0],
    [3.0,4.0,5.0,6.0],
    [4.0,5.0,6.0,7.0],
])
E = torch.mean(X)
V = torch.var(X,unbiased=True)
print(V)
# tensor(2.6667)

Y = (X-E)/torch.sqrt(V + 1e-5) * 1 + 0
print(Y)
# tensor([[-1.8371, -1.2247, -0.6124,  0.0000],
#         [-1.2247, -0.6124,  0.0000,  0.6124],
#         [-0.6124,  0.0000,  0.6124,  1.2247],
#         [ 0.0000,  0.6124,  1.2247,  1.8371]])
import torch
import torchvision
import torchvision.transforms as transforms
import torch.nn as nn
import os
import torch.nn.functional as F
gpu_device = torch.device("cuda")
cpu_device = torch.device("cpu")
class PreprocessAndCalculateModel(nn.Module):
    def __init__(self):
        super().__init__()
    def forward(self, x):
        device = x.device
        output = torch.poisson(x)
        return output

real_inputs = torch.Tensor([[0.3573, 0.4895, 0.4495, 0.0817, 0.0811, 0.4988, 0.1488, 0.5184, 0.5987,
         0.3230, 0.9409, 0.3695, 0.2919, 0.7240, 0.9843, 0.0806, 0.8317, 0.9894,
         0.5811, 0.1429, 0.5898, 0.2921, 0.9795, 0.9853, 0.5050, 0.5445, 0.9673,
         0.6334, 0.0038, 0.2301, 0.7699, 0.5024, 0.5945, 0.6227, 0.6165, 0.6490,
         0.0551, 0.9743, 0.5165, 0.0146, 0.1773, 0.0354, 0.4421, 0.7244, 0.1829,
         0.7958, 0.4110, 0.7044, 0.8823, 0.2035, 0.7964, 0.3728, 0.5896, 0.2977,
         0.9093, 0.8081, 0.3494, 0.2043, 0.9817, 0.0533, 0.1804, 0.2295, 0.8109,
         0.5291, 0.1847, 0.5210, 0.9392, 0.9617, 0.6915, 0.1526, 0.1051, 0.4268,
         0.6355, 0.9918, 0.4574, 0.9920, 0.1022, 0.6937, 0.7907, 0.6325, 0.7703,
         0.3477, 0.5574, 0.5820, 0.0031, 0.2237, 0.1554, 0.8342, 0.6942, 0.2824,
         0.0514, 0.4588, 0.6980, 0.2988, 0.0223, 0.5258, 0.7285, 0.0436, 0.1735,
         0.1313, 0.6822, 0.1350, 0.9064, 0.1723, 0.9615, 0.7732, 0.4006, 0.4286,
         0.9574, 0.1993, 0.3626, 0.5721, 0.2786, 0.5803, 0.5418, 0.4326, 0.4383,
         0.1874, 0.8700, 0.4799, 0.7352, 0.5455, 0.0830, 0.5823, 0.7995, 0.9164,
         0.9128, 0.6769, 0.9824, 0.3330, 0.3252, 0.0235, 0.2467, 0.9552, 0.4141,
         0.0080, 0.6585, 0.1489, 0.6302, 0.4334, 0.4517, 0.1015, 0.0576, 0.1018,
         0.4613, 0.7786, 0.7891, 0.4809, 0.1440, 0.9522, 0.7496, 0.3661, 0.6143,
         0.5339, 0.1719, 0.5208, 0.9730, 0.1087, 0.9995, 0.8461, 0.8586, 0.8734,
         0.9743, 0.9941, 0.6799, 0.4233, 0.8083, 0.9026, 0.7692, 0.0321, 0.1951,
         0.0229, 0.6364, 0.7308, 0.5875, 0.8557, 0.9997, 0.6156, 0.3345, 0.5139,
         0.0327, 0.2910, 0.7762, 0.0645, 0.2058, 0.6203, 0.2110, 0.1811, 0.1185,
         0.5627, 0.8874, 0.4320],
        [0.0000, 0.2287, 0.6236, 0.6008, 0.5647, 0.6437, 0.9637, 0.0551, 0.8613,
         0.5134, 0.5436, 0.1173, 0.2392, 0.6664, 0.7456, 0.3174, 0.5355, 0.7197,
         0.1143, 0.1166, 0.2682, 0.2288, 0.9237, 0.2634, 0.1560, 0.4699, 0.3789,
         0.4599, 0.2896, 0.2917, 0.0208, 0.5018, 0.0169, 0.0949, 0.9472, 0.1807,
         0.6437, 0.8341, 0.2446, 0.6754, 0.5108, 0.0893, 0.7278, 0.6476, 0.5648,
         0.6557, 0.7240, 0.2317, 0.0688, 0.1365, 0.4267, 0.0630, 0.0043, 0.3734,
         0.4019, 0.0108, 0.2598, 0.0209, 0.9461, 0.6779, 0.8723, 0.4475, 0.4261,
         0.1138, 0.6684, 0.0851, 0.1653, 0.6335, 0.7823, 0.0765, 0.5810, 0.0038,
         0.2606, 0.3728, 0.8219, 0.0128, 0.1253, 0.5833, 0.1529, 0.7280, 0.1453,
         0.7546, 0.7213, 0.5201, 0.6662, 0.2081, 0.7024, 0.2859, 0.1228, 0.9676,
         0.3600, 0.5428, 0.3235, 0.7429, 0.9878, 0.7691, 0.4601, 0.6803, 0.0535,
         0.1425, 0.3515, 0.4539, 0.1933, 0.1699, 0.5552, 0.3392, 0.9746, 0.6650,
         0.3807, 0.0351, 0.0609, 0.0541, 0.1948, 0.2767, 0.4967, 0.2079, 0.8308,
         0.0394, 0.2337, 0.5920, 0.2279, 0.0403, 0.9055, 0.3598, 0.8903, 0.4758,
         0.2635, 0.0269, 0.0557, 0.0479, 0.6887, 0.8597, 0.0125, 0.5415, 0.6774,
         0.4632, 0.0305, 0.4721, 0.7850, 0.9019, 0.4772, 0.4710, 0.8768, 0.0299,
         0.4382, 0.8055, 0.6128, 0.2952, 0.8071, 0.1200, 0.2702, 0.7917, 0.8191,
         0.5822, 0.0316, 0.2664, 0.1857, 0.0848, 0.5092, 0.8874, 0.0905, 0.4543,
         0.4307, 0.3454, 0.9335, 0.4406, 0.8424, 0.8188, 0.0537, 0.8329, 0.6865,
         0.0890, 0.7521, 0.3397, 0.5854, 0.3785, 0.5885, 0.4095, 0.8788, 0.5916,
         0.9072, 0.8359, 0.9801, 0.2578, 0.6461, 0.8757, 0.2651, 0.9520, 0.8664,
         0.4447, 0.7352, 0.5184]])

model = PreprocessAndCalculateModel()
x = real_inputs
output_gpu = model.to(gpu_device)(x.cuda())
output_cpu = model.to(cpu_device)(x.cpu())
print(torch.allclose(output_gpu.cpu(), output_cpu, atol=1e-1))
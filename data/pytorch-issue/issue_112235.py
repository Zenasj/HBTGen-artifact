import torch.nn as nn

{"pid":6,"type":"jupyter","level":40,"msg":"frame #17: _PyEval_EvalFrameDefault + 0x6516 (0x5921a3045c66 in /usr/bin/python3)","time":"2023-10-27T05:54:25.625Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #18: <unknown function> + 0x7e368c (0x78b26996968c in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_python.so)","time":"2023-10-27T05:54:25.625Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #19: _PyFunction_Vectorcall + 0x7c (0x5921a305770c in /usr/bin/python3)","time":"2023-10-27T05:54:25.625Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #20: _PyEval_EvalFrameDefault + 0x802 (0x5921a303ff52 in /usr/bin/python3)","time":"2023-10-27T05:54:25.625Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #21: <unknown function> + 0x7e368c (0x78b26996968c in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_python.so)","time":"2023-10-27T05:54:25.625Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #22: <unknown function> + 0x15bca8 (0x5921a3052ca8 in /usr/bin/python3)","time":"2023-10-27T05:54:25.625Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #23: <unknown function> + 0x27a9e8 (0x5921a31719e8 in /usr/bin/python3)","time":"2023-10-27T05:54:25.625Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #24: _PyEval_EvalFrameDefault + 0x6bd (0x5921a303fe0d in /usr/bin/python3)","time":"2023-10-27T05:54:25.625Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #25: <unknown function> + 0x7e368c (0x78b26996968c in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_python.so)","time":"2023-10-27T05:54:25.625Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #26: _PyFunction_Vectorcall + 0x7c (0x5921a305770c in /usr/bin/python3)","time":"2023-10-27T05:54:25.625Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #27: _PyEval_EvalFrameDefault + 0x6bd (0x5921a303fe0d in /usr/bin/python3)","time":"2023-10-27T05:54:25.625Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #28: <unknown function> + 0x7e368c (0x78b26996968c in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_python.so)","time":"2023-10-27T05:54:25.625Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #29: _PyFunction_Vectorcall + 0x7c (0x5921a305770c in /usr/bin/python3)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #30: _PyEval_EvalFrameDefault + 0x6bd (0x5921a303fe0d in /usr/bin/python3)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #31: <unknown function> + 0x7e368c (0x78b26996968c in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_python.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #32: _PyFunction_Vectorcall + 0x7c (0x5921a305770c in /usr/bin/python3)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #33: _PyEval_EvalFrameDefault + 0x802 (0x5921a303ff52 in /usr/bin/python3)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #34: <unknown function> + 0x7e368c (0x78b26996968c in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_python.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #35: _PyFunction_Vectorcall + 0x7c (0x5921a305770c in /usr/bin/python3)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #36: _PyEval_EvalFrameDefault + 0x802 (0x5921a303ff52 in /usr/bin/python3)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #37: <unknown function> + 0x7e368c (0x78b26996968c in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_python.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #38: _PyFunction_Vectorcall + 0x7c (0x5921a305770c in /usr/bin/python3)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #39: _PyEval_EvalFrameDefault + 0x2b71 (0x5921a30422c1 in /usr/bin/python3)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #40: <unknown function> + 0x7e368c (0x78b26996968c in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_python.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #41: <unknown function> + 0x16e62e (0x5921a306562e in /usr/bin/python3)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #42: <unknown function> + 0x164159 (0x5921a305b159 in /usr/bin/python3)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #43: PyObject_CallMethod + 0xc8 (0x5921a31324e8 in /usr/bin/python3)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #44: torch::handle_torch_function_no_python_arg_parser(c10::ArrayRef<_object*>, _object*, _object*, char const*, _object*, char const*, torch::TorchFunctionName) + 0x3b2 (0x78b269cec7e2 in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_python.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #45: <unknown function> + 0x71f2bd (0x78b2698a52bd in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_python.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #46: <unknown function> + 0x721d44 (0x78b2698a7d44 in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_python.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #47: c10::intrusive_ptr<c10::TensorImpl, c10::detail::intrusive_target_default_null_type<c10::TensorImpl> > c10::TensorImpl::shallow_copy_and_detach_core<c10::VariableVersion const&>(c10::VariableVersion const&, bool) const + 0x1ac (0x78b2c038ee7c in /usr/local/lib/python3.10/dist-packages/torch/lib/libc10.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #48: c10::TensorImpl::shallow_copy_and_detach(c10::VariableVersion const&, bool) const + 0xd (0x78b2c038541d in /usr/local/lib/python3.10/dist-packages/torch/lib/libc10.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #49: <unknown function> + 0x4a9c312 (0x78b2566b5312 in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_cpu.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #50: <unknown function> + 0x4a9ca17 (0x78b2566b5a17 in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_cpu.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #51: <unknown function> + 0x56253ed (0x78b25723e3ed in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_cpu.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #52: <unknown function> + 0x56266ee (0x78b25723f6ee in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_cpu.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #53: <unknown function> + 0x726d7f (0x78b2698acd7f in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_python.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #54: <unknown function> + 0x19fb347 (0x78b253614347 in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_cpu.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #55: <unknown function> + 0x245e738 (0x78b254077738 in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_cpu.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #56: at::_ops::detach::redispatch(c10::DispatchKeySet, at::Tensor const&) + 0xf5 (0x78b254135fb5 in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_cpu.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #57: <unknown function> + 0x562ae95 (0x78b257243e95 in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_cpu.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #58: <unknown function> + 0x562afde (0x78b257243fde in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_cpu.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #59: <unknown function> + 0x726d7f (0x78b2698acd7f in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_python.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #60: <unknown function> + 0x19fb347 (0x78b253614347 in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_cpu.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #61: <unknown function> + 0x19fb827 (0x78b253614827 in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_cpu.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #62: <unknown function> + 0x726d7f (0x78b2698acd7f in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_python.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"frame #63: <unknown function> + 0x19fb347 (0x78b253614347 in /usr/local/lib/python3.10/dist-packages/torch/lib/libtorch_cpu.so)","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"[W execution_trace_observer.cpp:619] Exception in execution trace observer: [aten::detach (0)] Cannot call storage_offset() on tensor with symbolic sizes/strides","time":"2023-10-27T05:54:25.626Z","v":0}
{"pid":6,"type":"jupyter","level":40,"msg":"Exception raised from storage_offset_default at ../c10/core/TensorImpl.h:754 (most recent call first):","time":"2023-10-27T05:54:25.626Z","v":0}

import torch
from torch.profiler import ExecutionTraceObserver

et = ExecutionTraceObserver()

class MyModule(torch.nn.Module):
    def __init__(self):
        super().__init__()
        self.lin = torch.nn.Linear(100, 10)

    def forward(self, x):
        return torch.nn.functional.relu(self.lin(x))

mod = MyModule()
opt_mod = torch.compile(mod)

et.register_callback("/tmp/linear_execution_trace_iter0.json")
inp1 = torch.randn(10, 100)
et.start()
out = opt_mod(inp1)
et.stop()
et.unregister_callback()

et.register_callback("/tmp/linear_execution_trace_iter1.json")
inp2 = torch.randn(20, 100)
et.start()
out = opt_mod(inp2)
et.stop()
et.unregister_callback()
import torch.nn as nn

import torch
# turn off the speed-up that may hurts the precision
torch.backends.cuda.matmul.allow_tf32 = False
torch.backends.cudnn.allow_tf32 = False
torch.backends.cudnn.benchmark = False

print(torch.__version__)
# Out: 1.9.1+cu111

# Suppose I have two SE(3) matrix [R | t], and the t is very big in milllions. 
x = torch.tensor([[-4.6716669202e-01,  8.8406556845e-01, -1.3541741297e-02,
         -3.6795465000e+06],
        [-8.8412499428e-01, -4.6693515778e-01,  1.7163248733e-02,
          2.4627352500e+06],
        [ 8.8503211737e-03,  1.9990688190e-02,  9.9976092577e-01,
         -9.2138648438e+04],
        [ 0.0000000000e+00,  0.0000000000e+00,  0.0000000000e+00,
          1.0000000000e+00]])

y = torch.tensor([[-4.6641114354e-01, -8.8452386856e-01,  8.8395737112e-03,
          4.5921921875e+05],
        [ 8.8449001312e-01, -4.6621400118e-01,  1.7941327766e-02,
          4.4047410000e+06],
        [-1.1748399585e-02,  1.6186550260e-02,  9.9979996681e-01,
          2.0620735168e+01],
        [ 0.0000000000e+00,  0.0000000000e+00,  0.0000000000e+00,
          1.0000000000e+00]])

res_t = x @ y
print(res_t)
# Out:
# tensor([[ 1.0000e+00,  8.3714e-04, -1.8073e-03,  1.2500e+00],
#        [-8.3536e-04,  1.0000e+00,  9.6709e-04,  0.0000e+00],
#       [ 1.8081e-03, -9.6558e-04,  1.0000e+00,  7.8125e-03],
#        [ 0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00]])

res_t = x.cuda() @ y.cuda()
print(res_t)
# Out:
# tensor([[ 1.0000e+00,  8.3715e-04, -1.8073e-03,  1.0000e+00],
#        [-8.3536e-04,  1.0000e+00,  9.6709e-04,  0.0000e+00],
#       [ 1.8081e-03, -9.6558e-04,  1.0000e+00,  7.8125e-03],
#        [ 0.0000e+00,  0.0000e+00,  0.0000e+00,  1.0000e+00]], device='cuda:0')
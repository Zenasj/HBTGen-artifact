import torch
import torchvision
import torchvision.transforms as transforms
import torch.nn as nn
import os
import torch.nn.functional as F
gpu_device = torch.device("cuda")
cpu_device = torch.device("cpu")
class PreprocessAndCalculateModel(nn.Module):
    def __init__(self):
        super().__init__()
    def forward(self, x):
        device = x.device
        output = torch.multinomial(x.view(-1), 5)
        return output

real_inputs = torch.Tensor([[[[0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000]],

         [[0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.5106, 0.1236, 0.7835, 0.8078, 0.3358, 0.1127, 0.8677,
           0.4837, 0.0000],
          [0.0000, 0.1685, 0.6760, 0.3264, 0.7788, 0.6223, 0.4483, 0.7890,
           0.2932, 0.0000],
          [0.0000, 0.0240, 0.3664, 0.9235, 0.1534, 0.8121, 0.5511, 0.9247,
           0.7550, 0.0000],
          [0.0000, 0.1678, 0.2448, 0.7521, 0.4274, 0.5757, 0.7075, 0.9931,
           0.7644, 0.0000],
          [0.0000, 0.2295, 0.1500, 0.9408, 0.9197, 0.7807, 0.3738, 0.8475,
           0.3060, 0.0000],
          [0.0000, 0.4473, 0.8933, 0.4188, 0.1854, 0.8583, 0.8492, 0.6049,
           0.7643, 0.0000],
          [0.0000, 0.0241, 0.8451, 0.5529, 0.9139, 0.0024, 0.6462, 0.1935,
           0.9254, 0.0000],
          [0.0000, 0.3808, 0.4526, 0.2570, 0.9933, 0.3676, 0.6640, 0.1478,
           0.7725, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000]],

         [[0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.6809, 0.3976, 0.6230, 0.2930, 0.0656, 0.3112, 0.6771,
           0.3126, 0.0000],
          [0.0000, 0.5249, 0.6431, 0.3184, 0.6751, 0.6731, 0.0351, 0.2720,
           0.0785, 0.0000],
          [0.0000, 0.1649, 0.6019, 0.2353, 0.6034, 0.4284, 0.1185, 0.3040,
           0.0160, 0.0000],
          [0.0000, 0.2844, 0.3954, 0.0813, 0.8554, 0.8411, 0.7853, 0.5893,
           0.1451, 0.0000],
          [0.0000, 0.0975, 0.5862, 0.9979, 0.8223, 0.5730, 0.8681, 0.4527,
           0.4733, 0.0000],
          [0.0000, 0.3255, 0.3783, 0.0695, 0.5081, 0.1834, 0.7018, 0.9174,
           0.1658, 0.0000],
          [0.0000, 0.1667, 0.5946, 0.9293, 0.9546, 0.2415, 0.0080, 0.5098,
           0.5462, 0.0000],
          [0.0000, 0.2047, 0.4238, 0.8186, 0.5184, 0.5021, 0.6840, 0.4096,
           0.9866, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000]],

         [[0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0392, 0.0261, 0.1781, 0.0744, 0.0420, 0.5790, 0.3216,
           0.4606, 0.0000],
          [0.0000, 0.9227, 0.6754, 0.8144, 0.7060, 0.0570, 0.7683, 0.6628,
           0.4722, 0.0000],
          [0.0000, 0.3036, 0.2758, 0.4072, 0.8473, 0.1463, 0.5377, 0.3792,
           0.6099, 0.0000],
          [0.0000, 0.2959, 0.3142, 0.4948, 0.9362, 0.2659, 0.5665, 0.3299,
           0.7983, 0.0000],
          [0.0000, 0.2297, 0.5466, 0.1205, 0.3303, 0.9620, 0.4007, 0.2675,
           0.0118, 0.0000],
          [0.0000, 0.3218, 0.9869, 0.9551, 0.2336, 0.4216, 0.1992, 0.4736,
           0.2325, 0.0000],
          [0.0000, 0.9967, 0.3143, 0.7999, 0.3640, 0.9507, 0.5100, 0.0230,
           0.6513, 0.0000],
          [0.0000, 0.4665, 0.6002, 0.7051, 0.9916, 0.4650, 0.3989, 0.7333,
           0.0991, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000]],

         [[0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000]]],


        [[[0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000]],

         [[0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.4103, 0.2500, 0.9281, 0.3680, 0.4891, 0.2297, 0.7333,
           0.1832, 0.0000],
          [0.0000, 0.2033, 0.2282, 0.3077, 0.0299, 0.2908, 0.8824, 0.6231,
           0.6540, 0.0000],
          [0.0000, 0.3053, 0.4224, 0.2752, 0.5633, 0.2063, 0.5449, 0.6883,
           0.9916, 0.0000],
          [0.0000, 0.7479, 0.7862, 0.4697, 0.2546, 0.5963, 0.6023, 0.7993,
           0.8018, 0.0000],
          [0.0000, 0.3698, 0.6669, 0.5366, 0.7270, 0.7057, 0.7984, 0.2603,
           0.6635, 0.0000],
          [0.0000, 0.4561, 0.7208, 0.7049, 0.9444, 0.9990, 0.5519, 0.5999,
           0.8801, 0.0000],
          [0.0000, 0.3525, 0.9726, 0.3446, 0.1274, 0.1534, 0.0524, 0.8820,
           0.2963, 0.0000],
          [0.0000, 0.0056, 0.1093, 0.4274, 0.3482, 0.3512, 0.2104, 0.9093,
           0.1549, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000]],

         [[0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.8089, 0.5100, 0.5782, 0.4837, 0.1329, 0.2512, 0.7160,
           0.2709, 0.0000],
          [0.0000, 0.6185, 0.9033, 0.0177, 0.1583, 0.8791, 0.2840, 0.2138,
           0.7127, 0.0000],
          [0.0000, 0.5862, 0.4276, 0.0768, 0.1374, 0.9145, 0.4485, 0.9581,
           0.2553, 0.0000],
          [0.0000, 0.5683, 0.4538, 0.0810, 0.1314, 0.5864, 0.4031, 0.6462,
           0.5828, 0.0000],
          [0.0000, 0.2974, 0.9643, 0.9690, 0.4057, 0.8575, 0.8333, 0.1483,
           0.9966, 0.0000],
          [0.0000, 0.6342, 0.1041, 0.0523, 0.2331, 0.2762, 0.3511, 0.3777,
           0.4197, 0.0000],
          [0.0000, 0.0648, 0.9803, 0.1450, 0.9086, 0.7645, 0.7491, 0.7261,
           0.9295, 0.0000],
          [0.0000, 0.1057, 0.6322, 0.0329, 0.3849, 0.0568, 0.3214, 0.0968,
           0.7891, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000]],

         [[0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.8343, 0.1481, 0.9260, 0.4687, 0.0028, 0.8059, 0.2511,
           0.8181, 0.0000],
          [0.0000, 0.5006, 0.3921, 0.2961, 0.0551, 0.4074, 0.4664, 0.9995,
           0.3945, 0.0000],
          [0.0000, 0.4981, 0.1057, 0.2837, 0.8725, 0.5148, 0.3916, 0.4789,
           0.6857, 0.0000],
          [0.0000, 0.8699, 0.7526, 0.0435, 0.2997, 0.8300, 0.2830, 0.1449,
           0.0600, 0.0000],
          [0.0000, 0.6047, 0.4942, 0.7440, 0.4092, 0.8717, 0.3320, 0.0482,
           0.5484, 0.0000],
          [0.0000, 0.6890, 0.1794, 0.4416, 0.5839, 0.9293, 0.9703, 0.4624,
           0.5613, 0.0000],
          [0.0000, 0.9519, 0.2447, 0.7257, 0.9614, 0.2400, 0.5405, 0.8298,
           0.0441, 0.0000],
          [0.0000, 0.5194, 0.2681, 0.0059, 0.3558, 0.5936, 0.3538, 0.9482,
           0.4535, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000]],

         [[0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
           0.0000, 0.0000]]]])
model = PreprocessAndCalculateModel()
x = real_inputs
output_gpu = model.to(gpu_device)(x.cuda())
output_cpu = model.to(cpu_device)(x.cpu())
print(output_gpu)
print(output_cpu)
print(torch.allclose(output_gpu.cpu(), output_cpu, atol=1e+1))